{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
        <button type="submit" form="form-location" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>
        <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a></div>
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    {% if error_warning %}
    <div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_form }}</h3>
      </div>
      <div class="panel-body">
        <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-location" class="form-horizontal">
	  <div class="form-group">
                <label class="col-sm-2 control-label" for="input-customer-group"><span data-toggle="tooltip" data-container="#content" title="{{ help_customer_group }}">{{ entry_customer_group }}</span></label>
                <div class="col-sm-10">
                  <select name="customer_group_id" id="input-customer-group" class="form-control">
					<option>{{ text_select }}</option>
                    {% for customer_group in customer_groups %}
						{% if customer_group.customer_group_id == customer_group_id %}
							<option value="{{ customer_group.customer_group_id }}" selected="selected">{{ customer_group.name }}</option>
						{% else %}
							<option value="{{ customer_group.customer_group_id }}">{{ customer_group.name }}</option>
						{% endif %}
                    {% endfor %}
                  </select>
                </div>
          </div>
	  <div class="form-group">
                <label class="col-sm-2 control-label" for="input-store"><span data-toggle="tooltip" data-container="#content" title="{{ help_store }}">{{ entry_store }}</span></label>
                <div class="col-sm-10">
                  <select name="store" id="input-store" class="form-control">
					{% for store in stores %}
						{% if store.store_id == store_id %}
							<option value="{{ store.store_id }}" selected="selected">{{ store.name }}</option>
						{% else %}
							<option value="{{ store.store_id }}">{{ store.name }}</option>
						{% endif %}
                    {% endfor %}
                  </select>
                </div>
          </div>
          <div class="form-group required">
            <label class="col-sm-2 control-label" for="input-name">{{ entry_name }}</label>
            <div class="col-sm-10">
              <input type="text" name="name" value="{{ name }}" placeholder="{{ entry_name }}" id="input-name" class="form-control" />
              {% if error_name %}
              <div class="text-danger">{{ error_name }}</div>
              {% endif %}
            </div>
          </div>
          <div class="form-group required">
            <label class="col-sm-2 control-label" for="input-address">{{ entry_address }}</label>
            <div class="col-sm-10">
              <textarea type="text" name="address" placeholder="{{ entry_address }}" rows="5" id="input-address" class="form-control">{{ address }}</textarea>
              {% if error_address %}
              <div class="text-danger">{{ error_address }}</div>
             {% endif %}
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-geocode"><span data-toggle="tooltip" data-container="#content" title="{{ help_geocode }}">{{ entry_geocode }}</span></label>
            <div class="col-sm-10">
              <input type="text" name="geocode" value="{{ geocode }}" placeholder="{{ entry_geocode }}" id="input-geocode" class="form-control" />
            </div>
	    {% if error_geocode %}
              <div class="text-danger">{{ error_geocode }}</div>
            {% endif %}
          </div>
          <div class="form-group required">
            <label class="col-sm-2 control-label" for="input-telephone">{{ entry_telephone }}</label>
            <div class="col-sm-10">
              <input type="text" name="telephone" value="{{ telephone }}" placeholder="{{ entry_telephone }}" id="input-telephone" class="form-control" />
              {% if error_telephone %}
              <div class="text-danger">{{ error_telephone }}</div>
              {% endif %}
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-telephone">{{ entry_fax }}</label>
            <div class="col-sm-10">
              <input type="text" name="fax" value="{{ fax }}" placeholder="{{ entry_fax }}" id="input-fax" class="form-control" />
            </div>
          </div>          
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-image">{{ entry_image }}</label>
            <div class="col-sm-10"><a href="" id="thumb-image" data-toggle="image" class="img-thumbnail"><img src="{{ thumb }}" alt="" title="" data-placeholder="{{ placeholder }}" /></a>
              <input type="hidden" name="image" value="{{ image }}" id="input-image" />
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-open"><span data-toggle="tooltip" data-container="#content" title="{{ help_open }}">{{ entry_open }}</span></label>
            <div class="col-sm-10">
              <textarea name="open" rows="5" placeholder="{{ entry_open }}" id="input-open" class="form-control">{{ open }}</textarea>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-comment"><span data-toggle="tooltip" data-container="#content" title="{{ help_comment }}">{{ entry_comment }}</span></label>
            <div class="col-sm-10">
              <textarea name="comment" rows="5" placeholder="{{ entry_comment }}" id="input-comment" class="form-control">{{ comment }}</textarea>
            </div>
          </div>
	  <div class="form-group">
                <label class="col-sm-2 control-label" for="input-is-partner"><span data-toggle="tooltip" data-container="#content" title="{{ help_is_partner }}">{{ entry_is_partner }}</span></label>
                <div class="col-sm-10">
                  <select name="is_partner" id="input-is-partner" class="form-control">
			{% if is_partner %}
				<option value="1" selected="selected">{{ text_yes }}</option>
				<option value="0">{{ text_no }}</option>
			{% else %}
				<option value="1">{{ text_yes }}</option>
				<option value="0" selected="selected">{{ text_no }}</option>
			{% endif %}
                  </select>
                </div>
          </div>
        </form>
      </div>
    </div>
  </div>
// Customer Groups
<script type="text/javascript"><!--
	$('select[name=\'customer_group_id\']').on('change', function() {
		$.ajax({
			url: '{{ catalog }}index.php?route=api/login&user_token={{ user_token }}',
			type: 'post',
			data: 'key={{ api_key }}',
			dataType: 'json',
			crossDomain: true,
			beforeSend: function() {
				$('select[name=\'customer_group_id\']').prop('disabled', true);
			},
			complete: function() {
				
			},
			success: function(json) {
				$('.alert-dismissible, .text-danger').remove();
						
				$('.form-location').removeClass('has-error');
				
				if (json['error']['ip']) {
					$('#content > .container-fluid').prepend('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error']['ip'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');

					// Highlight any found errors
					$('select[name=\'customer_group_id\']').closest('.form-location').addClass('has-error');
				} else if (json['api_token'] && json['api_session_id'] && json['success']) {
					$.ajax({
						url: '{{ catalog }}index.php?route=api/location&api_token=' + json['api_token'] + '&session_id=' + json['api_session_id'] + '&store_id={{ store_id }}',
						type: 'post',
						data: 'address=' + $('textarea[name=\'address\']).val() + '&geocode=' + $('input[name=\'geocode\']).val() + '&customer_group_id=' + $('select[name=\'customer_group_id\'] option:selected').val() + '&store_id={{ store_id }}',
						dataType: 'json',
						beforeSend: function() {
								
						},
						complete: function() {
							$('select[name=\'customer_group_id\']').prop('disabled', false);
						},
						success: function(location) {
							html = '';
							
							$('.alert-dismissible, .text-danger').remove();
								
							$('.form-location').removeClass('has-error');
							
							if (location['error']['warning']) {
								event = 'danger';
							} else {
								event = 'success';
							}
							
							html += '<div class="alert alert-' + event + ' alert-dismissible">';
								if (location['error']['warning']) {
									html += '<i class="fa fa-check-circle"></i> ';
									html += location['error']['warning'];
									
									// Highlight any found errors
									$('select[name=\'customer_group_id\']').closest('.form-location').addClass('has-error');
								}
										
								if (location['payment_address_success'] && location['payment_address']) {
										html += '<i class="fa fa-check-circle"></i> ';
										html += location['payment_address_success'] + '<br /><br />';
										
										html += '<div class="well">';
											html += '<ul class="list-check">';
											
											for (i in location['payment_address']) {
												html += '<li>' + location['payment_address'][i] + '</li>';
											}
												
											html += '</ul>';
										html += '</div>';
								}
								
								if (location['shipping_address_success'] && location['shipping_address']) {
										html += '<i class="fa fa-check-circle"></i> ';
										html += location['shipping_address_success'] + '<br /><br />';
										
										html += '<div class="well">';
											html += '<ul class="list-check">';
											
											for (i in location['shipping_address']) {
												html += '<li>' + location['shipping_address'][i] + '</li>';
											}
												
											html += '</ul>';
										html += '</div>';
								}
								
								if (location['payment_account_success'] && location['payment_account']) {
										html += '<i class="fa fa-check-circle"></i> ';
										html += location['payment_account_success'] + '<br /><br />';
										
										html += '<div class="well">';
											html += '<ul class="list-check">';
											
											for (i in location['payment_account']) {
												html += '<li>' + location['payment_account'][i] + '</li>';
											}
												
											html += '</ul>';
										html += '</div>';
								}
									
								html += '<button type="button" class="close" data-dismiss="alert">&times;</button>';
							html += '</div>';
								
							if ($html) {
								$('#content > .container-fluid').prepend(html);
							}
						},
						error: function(xhr, ajaxOptions, thrownError) {
							alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
						}
					});				
				}
			},
			error: function(xhr, ajaxOptions, thrownError) {
				alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
			}
		});
	});
//--></script></div>
{{ footer }}
